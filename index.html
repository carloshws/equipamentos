<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab. de Geotecnologias - Sistema de Controle de Equipamentos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Carregamento dos dados dos arquivos separados -->
  <script src="equipamentos.js"></script>
  <script src="alunos.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e'
            },
            secondary: {
              500: '#10b981',
              600: '#059669',
              700: '#047857'
            }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
      scroll-behavior: smooth;
      overflow-x: hidden;
    }
    
    /* Improved Glass Effect */
    .glass { 
      backdrop-filter: blur(20px) saturate(180%); 
      background: rgba(255, 255, 255, 0.95); 
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Enhanced Animations */
    .animate-slide-in { animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    .animate-scale-in { animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
    .animate-bounce-in { animation: bounceIn 0.6s ease-out; }
    
    @keyframes slideIn { 
      from { opacity: 0; transform: translateY(-20px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    
    @keyframes scaleIn { 
      from { opacity: 0; transform: scale(0.9); } 
      to { opacity: 1; transform: scale(1); } 
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    /* Hover Effects */
    .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
    
    .hover-scale { transition: transform 0.2s ease-out; }
    .hover-scale:hover { transform: scale(1.02); }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* Enhanced Gradients */
    .gradient-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .gradient-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .gradient-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    
    /* Loading Spinner */
    .spinner {
      width: 40px; height: 40px; border: 4px solid #f3f4f6; border-top: 4px solid #3b82f6;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Toast Notifications */
    .toast {
      position: fixed; top: 20px; right: 20px; z-index: 9999;
      background: white; border-radius: 12px; padding: 16px 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #10b981;
      transform: translateX(400px); opacity: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .toast.show {
      transform: translateX(0); opacity: 1;
    }
    
    .toast.error { border-left-color: #ef4444; }
    .toast.warning { border-left-color: #f59e0b; }
    .toast.info { border-left-color: #3b82f6; }
    
    /* Enhanced Form Elements */
    .form-input {
      transition: all 0.3s ease;
      border: 2px solid #e2e8f0;
    }
    
    .form-input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: scale(1.01);
    }
    
    /* Enhanced Cards */
    .card-enhanced {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-enhanced:hover {
      box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }
    
    /* Status Indicators */
    .status-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* Enhanced Buttons */
    .btn-enhanced {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .btn-enhanced::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn-enhanced:hover::before {
      left: 100%;
    }
    
    /* Enhanced Tables */
    .table-enhanced tbody tr {
      transition: all 0.2s ease;
    }
    
    .table-enhanced tbody tr:hover {
      background: rgba(59, 130, 246, 0.02);
      transform: scale(1.005);
    }
    
    /* Progress Bars */
    .progress-bar {
      height: 4px;
      background: #e2e8f0;
      border-radius: 2px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
    }
    
    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced Select */
    .select-enhanced {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }
    
    /* Glassmorphism Elements */
    .glass-card {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <!-- HEADER -->
  <header class="relative bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 shadow-2xl overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 bg-grid-pattern opacity-10"></div>
    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20"></div>
    
    <div class="relative max-w-7xl mx-auto px-4 py-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-6 animate-slide-in">
          <div class="relative">
            <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-4 rounded-2xl shadow-lg hover-scale">
              <i class="fas fa-satellite-dish text-white text-3xl"></i>
            </div>
            <div class="absolute -top-1 -right-1 bg-green-400 w-4 h-4 rounded-full status-pulse"></div>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-white mb-1">Lab. de Geotecnologias</h1>
            <p class="text-blue-200 text-sm font-medium">Sistema de Controle de Equipamentos • UFPR</p>
            <div class="flex items-center mt-2 space-x-4 text-xs text-blue-300">
              <span class="flex items-center">
                <i class="fas fa-map-marker-alt mr-1"></i>
                Setor de Ciências da Terra
              </span>
              <span class="flex items-center">
                <i class="fas fa-calendar mr-1"></i>
                <span id="currentDate"></span>
              </span>
            </div>
          </div>
        </div>
        
        <div class="flex items-center space-x-4 animate-fade-in">
          <!-- Quick Stats Mini -->
          <div class="hidden lg:flex items-center space-x-3 bg-white/10 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20">
            <div class="text-center">
              <div id="headerTotalEquip" class="text-xl font-bold text-white">73</div>
              <div class="text-xs text-blue-200">Total</div>
            </div>
            <div class="w-px h-8 bg-white/20"></div>
            <div class="text-center">
              <div id="headerAvailableEquip" class="text-xl font-bold text-green-400">73</div>
              <div class="text-xs text-blue-200">Disponíveis</div>
            </div>
          </div>
          
          <!-- Data Source Indicator -->
          <div id="dataSourceIndicator" class="glass-card px-4 py-3 hover-lift">
            <div class="flex items-center">
              <div class="spinner mr-3"></div>
              <span class="text-white font-medium text-sm">Carregando dados...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Decorative Bottom Wave -->
    <div class="absolute bottom-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-purple-500"></div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8 space-y-8">
    <!-- QUICK STATS -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
      <!-- Total Equipamentos -->
      <div class="card-enhanced p-6 hover-lift animate-scale-in" style="animation-delay: 0.1s">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center mb-2">
              <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
              <p class="text-gray-600 text-sm font-medium">Total de Equipamentos</p>
            </div>
            <p id="totalEquip" class="text-3xl font-bold text-gray-800 mb-1">0</p>
            <div class="progress-bar">
              <div class="progress-fill" style="width: 100%"></div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-2xl shadow-lg ml-4">
            <i class="fas fa-microchip text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Disponíveis -->
      <div class="card-enhanced p-6 hover-lift animate-scale-in" style="animation-delay: 0.2s">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center mb-2">
              <div class="w-2 h-2 bg-green-500 rounded-full mr-2 status-pulse"></div>
              <p class="text-gray-600 text-sm font-medium">Disponíveis</p>
            </div>
            <p id="availableEquip" class="text-3xl font-bold text-green-600 mb-1">0</p>
            <div class="progress-bar">
              <div id="availableProgress" class="progress-fill bg-gradient-to-r from-green-500 to-emerald-500" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-4 rounded-2xl shadow-lg ml-4">
            <i class="fas fa-check-circle text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Emprestados -->
      <div class="card-enhanced p-6 hover-lift animate-scale-in" style="animation-delay: 0.3s">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center mb-2">
              <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
              <p class="text-gray-600 text-sm font-medium">Emprestados</p>
            </div>
            <p id="loanedEquip" class="text-3xl font-bold text-orange-600 mb-1">0</p>
            <div class="progress-bar">
              <div id="loanedProgress" class="progress-fill bg-gradient-to-r from-orange-500 to-red-500" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-orange-500 to-red-600 p-4 rounded-2xl shadow-lg ml-4">
            <i class="fas fa-clock text-white text-xl"></i>
          </div>
        </div>
      </div>

      <!-- Alunos Ativos -->
      <div class="card-enhanced p-6 hover-lift animate-scale-in" style="animation-delay: 0.4s">
        <div class="flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center mb-2">
              <div class="w-2 h-2 bg-purple-500 rounded-full mr-2"></div>
              <p class="text-gray-600 text-sm font-medium">Alunos Ativos</p>
            </div>
            <p id="activeStudents" class="text-3xl font-bold text-purple-600 mb-1">0</p>
            <div class="progress-bar">
              <div id="studentsProgress" class="progress-fill bg-gradient-to-r from-purple-500 to-pink-500" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-purple-500 to-pink-600 p-4 rounded-2xl shadow-lg ml-4">
            <i class="fas fa-user-graduate text-white text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- EMPRÉSTIMO/DEVOLUÇÃO -->
    <section class="card-enhanced overflow-hidden animate-slide-in" style="animation-delay: 0.5s">
      <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 px-8 py-6 relative overflow-hidden">
        <div class="absolute inset-0 bg-black/10"></div>
        <div class="relative">
          <h2 class="text-2xl font-bold text-white flex items-center mb-2">
            <div class="bg-white/20 p-2 rounded-lg mr-4">
              <i class="fas fa-exchange-alt text-white"></i>
            </div>
            Empréstimo e Devolução de Equipamentos
          </h2>
          <p class="text-indigo-100 text-sm">Gerencie empréstimos de forma rápida e eficiente</p>
        </div>
      </div>
      
      <div class="p-8 bg-gradient-to-br from-gray-50 to-white">
        <form id="loanForm" class="space-y-8">
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            
            <!-- EQUIPAMENTOS -->
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <label class="flex items-center text-lg font-bold text-gray-800">
                  <div class="bg-blue-500 p-2 rounded-lg mr-3">
                    <i class="fas fa-microchip text-white text-sm"></i>
                  </div>
                  Equipamentos
                </label>
                <span id="selectedEquipCount" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">0 selecionados</span>
              </div>
              
              <div class="relative group">
                <select id="equipmentSelect" multiple size="10" required 
                        class="form-input select-enhanced w-full p-4 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md focus:shadow-lg text-sm">
                </select>
                <div class="absolute top-3 right-3 glass-card px-3 py-1 text-xs font-medium text-gray-600">
                  <i class="fas fa-mouse mr-1"></i>
                  Ctrl + clique
                </div>
              </div>
              
              <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <div class="flex items-center text-blue-800 mb-2">
                  <i class="fas fa-lightbulb mr-2"></i>
                  <span class="font-semibold text-sm">Dica</span>
                </div>
                <p class="text-blue-700 text-xs">Use Ctrl + clique para selecionar múltiplos equipamentos da mesma categoria</p>
              </div>
            </div>

            <!-- ALUNOS -->
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <label class="flex items-center text-lg font-bold text-gray-800">
                  <div class="bg-green-500 p-2 rounded-lg mr-3">
                    <i class="fas fa-user-graduate text-white text-sm"></i>
                  </div>
                  Alunos Responsáveis
                </label>
                <span id="selectedStudentCount" class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">0 selecionados</span>
              </div>
              
              <div class="relative">
                <select id="studentSelect" multiple size="10" required 
                        class="form-input select-enhanced w-full p-4 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md focus:shadow-lg text-sm">
                </select>
                <div class="absolute bottom-3 right-3 glass-card px-3 py-1 text-xs font-medium text-gray-600">
                  <i class="fas fa-search mr-1"></i>
                  Busca por nome
                </div>
              </div>

              <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                <div class="flex items-center text-green-800 mb-2">
                  <i class="fas fa-shield-alt mr-2"></i>
                  <span class="font-semibold text-sm">Responsabilidade</span>
                </div>
                <p class="text-green-700 text-xs">Todos os alunos selecionados serão responsáveis pelos equipamentos</p>
              </div>
            </div>

            <!-- AÇÕES -->
            <div class="space-y-6">
              <div class="space-y-4">
                <label class="flex items-center text-lg font-bold text-gray-800">
                  <div class="bg-orange-500 p-2 rounded-lg mr-3">
                    <i class="fas fa-calendar-alt text-white text-sm"></i>
                  </div>
                  Data de Saída
                </label>
                <input id="dateOut" type="date" required 
                       class="form-input w-full p-4 border-2 border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md focus:shadow-lg">
              </div>
              
              <button type="submit" 
                      class="btn-enhanced w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                <div class="flex items-center justify-center">
                  <i class="fas fa-paper-plane mr-3"></i>
                  <span>Confirmar Empréstimo</span>
                </div>
              </button>
              
              <div class="glass-card p-6 rounded-xl">
                <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                  <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                  Instruções Rápidas
                </h4>
                <div class="space-y-3 text-sm text-gray-600">
                  <div class="flex items-start">
                    <span class="bg-blue-100 text-blue-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                    <span>Selecione os equipamentos necessários</span>
                  </div>
                  <div class="flex items-start">
                    <span class="bg-green-100 text-green-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                    <span>Escolha os alunos responsáveis</span>
                  </div>
                  <div class="flex items-start">
                    <span class="bg-orange-100 text-orange-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                    <span>Confirme a data de saída</span>
                  </div>
                  <div class="flex items-start">
                    <span class="bg-purple-100 text-purple-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 mt-0.5">4</span>
                    <span>Finalize o empréstimo</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- INVENTÁRIO -->
    <section class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-secondary-500 to-secondary-600 px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-white flex items-center">
          <i class="fas fa-clipboard-list mr-3"></i>
          Inventário de Equipamentos
        </h2>
        <div class="flex items-center space-x-4">
          <select id="categoryFilter" class="bg-white text-gray-700 px-3 py-1 rounded-lg text-sm">
            <option value="">Todas as categorias</option>
          </select>
          <div class="bg-white bg-opacity-20 px-3 py-1 rounded-lg">
            <span id="equipCount" class="text-white font-medium">0 equipamentos</span>
          </div>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="table-enhanced w-full">
          <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
            <tr>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-microchip mr-2 text-blue-500"></i>
                  Equipamento
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-tags mr-2 text-green-500"></i>
                  Categoria
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-barcode mr-2 text-orange-500"></i>
                  Nº Série
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-info-circle mr-2 text-purple-500"></i>
                  Status
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-users mr-2 text-pink-500"></i>
                  Responsáveis
                </div>
              </th>
              <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center justify-center">
                  <i class="fas fa-cog mr-2 text-gray-500"></i>
                  Ação
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-gray-100">
          </tbody>
        </table>
      </div>
    </section>

    <!-- HISTÓRICO -->
    <section class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
      <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-white flex items-center">
          <i class="fas fa-history mr-3"></i>
          Histórico de Empréstimos
        </h2>
        <button id="clearBtn" 
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
          <i class="fas fa-trash-alt mr-2"></i>
          Limpar Histórico
        </button>
      </div>
      <div class="overflow-x-auto">
        <table class="table-enhanced w-full">
          <thead class="bg-gradient-to-r from-purple-50 to-purple-100 border-b-2 border-purple-200">
            <tr>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-tools mr-2 text-purple-500"></i>
                  Equipamentos
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-user-graduate mr-2 text-indigo-500"></i>
                  Alunos
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-calendar-plus mr-2 text-green-500"></i>
                  Data Saída
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-calendar-check mr-2 text-blue-500"></i>
                  Data Devolução
                </div>
              </th>
              <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                <div class="flex items-center">
                  <i class="fas fa-sticky-note mr-2 text-orange-500"></i>
                  Observações
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="histBody" class="divide-y divide-gray-100">
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-300 py-6 mt-12">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <div class="flex items-center justify-center space-x-4 mb-2">
        <i class="fas fa-university"></i>
        <span>&copy; 2025 UFPR - Universidade Federal do Paraná</span>
      </div>
      <p class="text-sm text-gray-400">Sistema de Controle de Equipamentos - Lab. de Geotecnologias</p>
    </div>
  </footer>

  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay" class="fixed inset-0 bg-gradient-to-br from-blue-900/80 to-purple-900/80 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="glass-card p-8 rounded-2xl shadow-2xl animate-bounce-in">
      <div class="flex flex-col items-center space-y-4">
        <div class="relative">
          <div class="spinner"></div>
          <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full animate-ping opacity-25"></div>
        </div>
        <div class="text-center">
          <h3 class="text-white text-lg font-bold mb-2">Inicializando Sistema</h3>
          <p class="text-blue-200 text-sm">Carregando dados dos equipamentos...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST CONTAINER -->
  <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- FLOATING ACTION BUTTON -->
  <div class="fab" onclick="scrollToTop()" title="Voltar ao topo">
    <i class="fas fa-arrow-up text-white"></i>
  </div>

  <script>
  /* ======== DATA MANAGEMENT ======== */
  let equipData = [];
  let studentData = [];
  let historyData = [];
  
  const HKEY = 'loanHistory';
  const loadHistory = () => {
    try {
      const data = JSON.parse(localStorage.getItem(HKEY));
      return Array.isArray(data) ? data : [];
    } catch {
      return [];
    }
  };

  /* ======== DATA FROM EXTERNAL FILES ======== */
  // Os dados são carregados automaticamente dos arquivos:
  // - equipamentos.js (edite este arquivo para modificar equipamentos)
  // - alunos.js (edite este arquivo para modificar alunos)

  /* ======== DATA LOADING ======== */
  function loadDataFiles() {
    const indicator = document.getElementById('dataSourceIndicator');
    
    try {
      // Verifica se os dados dos arquivos externos foram carregados
      if (window.EQUIPAMENTOS_DATA && window.ALUNOS_DATA) {
        equipData = [...window.EQUIPAMENTOS_DATA];
        studentData = [...window.ALUNOS_DATA];
        console.log('✅ Dados carregados dos arquivos externos (equipamentos.js e alunos.js)');
        
        // Atualiza indicador - dados externos
        indicator.innerHTML = '<i class="fas fa-file-code text-green-500 mr-2"></i><span class="text-green-800 font-medium">Dados dos arquivos externos</span>';
        indicator.className = 'bg-green-100 px-4 py-2 rounded-lg';
        
      } else {
        // Fallback: dados básicos se os arquivos não carregarem
        console.warn('⚠️ Arquivos externos não encontrados, usando dados básicos');
        equipData = [
          {name:'Estação Total Leica TS06', serial:'440882', category:'Topografia', status:'Disponível', users:[]},
          {name:'Estação Total Leica TS06', serial:'440883', category:'Topografia', status:'Disponível', users:[]},
          {name:'Receptor GNSS Trimble', serial:'GNSS-12', category:'GNSS', status:'Disponível', users:[]}
        ];
        studentData = [
          {nome:'ADAO GABRIEL DOS PASSOS', matricula:'GRR20210001', curso:'Engenharia Cartográfica', email:'adao@ufpr.br'},
          {nome:'ALAN KALANI WAISMANN', matricula:'GRR20210002', curso:'Engenharia Cartográfica', email:'alan@ufpr.br'},
          {nome:'AMANDA BEATRIZ DA SILVA PAIVA', matricula:'GRR20210003', curso:'Engenharia Cartográfica', email:'amanda@ufpr.br'}
        ];
        
        // Atualiza indicador - dados básicos
        indicator.innerHTML = '<i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i><span class="text-orange-800 font-medium">Dados básicos (arquivos não encontrados)</span>';
        indicator.className = 'bg-orange-100 px-4 py-2 rounded-lg';
      }
      
      // Garante que todos os equipamentos tenham as propriedades necessárias
      equipData = equipData.map(e => ({
        ...e,
        status: e.status || 'Disponível',
        users: Array.isArray(e.users) ? e.users : []
      }));
      
      historyData = loadHistory();
      
    } catch (error) {
      console.error('❌ Erro ao carregar dados:', error);
      
      // Dados de emergência
      equipData = [
        {name:'Equipamento Exemplo', serial:'EX-001', category:'Exemplo', status:'Disponível', users:[]}
      ];
      studentData = [
        {nome:'EXEMPLO ALUNO', matricula:'GRR20210000', curso:'Engenharia Cartográfica', email:'exemplo@ufpr.br'}
      ];
      historyData = [];
      
      // Indica erro
      indicator.innerHTML = '<i class="fas fa-times-circle text-red-500 mr-2"></i><span class="text-red-800 font-medium">Erro no carregamento</span>';
      indicator.className = 'bg-red-100 px-4 py-2 rounded-lg';
    }
  }

  /* ======== DOM REFERENCES ======== */
  const equipSel = document.getElementById('equipmentSelect');
  const studSel = document.getElementById('studentSelect');
  const tbody = document.getElementById('tableBody');
  const histBody = document.getElementById('histBody');
  const categoryFilter = document.getElementById('categoryFilter');
  const loadingOverlay = document.getElementById('loadingOverlay');

  /* ======== UTILITY FUNCTIONS ======== */
  const today = () => new Date().toLocaleDateString('pt-BR');
  const saveHistory = () => localStorage.setItem(HKEY, JSON.stringify(historyData));

  /* ======== TOAST NOTIFICATIONS ======== */
  function showToast(message, type = 'success', duration = 4000) {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    
    const icons = {
      success: 'fas fa-check-circle',
      error: 'fas fa-exclamation-circle', 
      warning: 'fas fa-exclamation-triangle',
      info: 'fas fa-info-circle'
    };
    
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <div class="flex items-center">
        <i class="${icons[type]} mr-3 text-lg"></i>
        <div>
          <div class="font-semibold text-sm">${message}</div>
        </div>
        <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600">
          <i class="fas fa-times"></i>
        </button>
      </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Animate in
    setTimeout(() => toast.classList.add('show'), 100);
    
    // Auto remove
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 500);
    }, duration);
  }

  /* ======== ENHANCED INTERACTIONS ======== */
  function updateSelectionCounters() {
    const equipCount = document.querySelectorAll('#equipmentSelect option:checked').length;
    const studentCount = document.querySelectorAll('#studentSelect option:checked').length;
    
    document.getElementById('selectedEquipCount').textContent = `${equipCount} selecionado${equipCount !== 1 ? 's' : ''}`;
    document.getElementById('selectedStudentCount').textContent = `${studentCount} selecionado${studentCount !== 1 ? 's' : ''}`;
  }

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function updateCurrentDate() {
    const now = new Date();
    const options = { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    };
    document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-BR', options);
  }

  function animateNumber(element, target, duration = 1000) {
    const start = parseInt(element.textContent) || 0;
    const increment = (target - start) / (duration / 16);
    let current = start;
    
    const timer = setInterval(() => {
      current += increment;
      if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
        current = target;
        clearInterval(timer);
      }
      element.textContent = Math.floor(current);
    }, 16);
  }

  /* ======== STATS UPDATE ======== */
  function updateStats() {
    const total = equipData.length;
    const available = equipData.filter(e => e.status === 'Disponível').length;
    const loaned = equipData.filter(e => e.status === 'Emprestado').length;
    
    const activeStudents = new Set();
    equipData.filter(e => e.status === 'Emprestado').forEach(e => {
      e.users.forEach(user => activeStudents.add(user));
    });
    const activeStudentCount = activeStudents.size;

    // Animate main stats
    animateNumber(document.getElementById('totalEquip'), total);
    animateNumber(document.getElementById('availableEquip'), available);
    animateNumber(document.getElementById('loanedEquip'), loaned);
    animateNumber(document.getElementById('activeStudents'), activeStudentCount);

    // Update header mini stats
    animateNumber(document.getElementById('headerTotalEquip'), total);
    animateNumber(document.getElementById('headerAvailableEquip'), available);

    // Update progress bars
    setTimeout(() => {
      const availablePercentage = total > 0 ? (available / total) * 100 : 0;
      const loanedPercentage = total > 0 ? (loaned / total) * 100 : 0;
      const studentsPercentage = Math.min((activeStudentCount / 40) * 100, 100); // Max 40 students

      document.getElementById('availableProgress').style.width = `${availablePercentage}%`;
      document.getElementById('loanedProgress').style.width = `${loanedPercentage}%`;
      document.getElementById('studentsProgress').style.width = `${studentsPercentage}%`;
    }, 500);
  }

  /* ======== RENDER FUNCTIONS ======== */
  function renderSelects() {
    // Equipment select
    equipSel.innerHTML = '';
    const availableEquip = equipData.filter(e => e.status === 'Disponível');
    availableEquip.forEach((e, i) => {
      const originalIndex = equipData.indexOf(e);
      const option = document.createElement('option');
      option.value = originalIndex;
      option.innerHTML = `<i class="fas fa-tools"></i> ${e.name} (${e.serial}) - ${e.category}`;
      option.textContent = `${e.name} (${e.serial}) - ${e.category}`;
      equipSel.appendChild(option);
    });

    // Student select
    studSel.innerHTML = '';
    studentData.forEach(s => {
      const option = document.createElement('option');
      option.value = s.nome;
      option.textContent = `${s.nome} (${s.matricula})`;
      studSel.appendChild(option);
    });

    // Category filter
    const categories = [...new Set(equipData.map(e => e.category))];
    categoryFilter.innerHTML = '<option value="">Todas as categorias</option>';
    categories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat;
      option.textContent = cat;
      categoryFilter.appendChild(option);
    });
  }

  function renderInventory() {
    const selectedCategory = categoryFilter.value;
    const filteredEquip = selectedCategory ? 
      equipData.filter(e => e.category === selectedCategory) : 
      equipData;

    tbody.innerHTML = '';
    filteredEquip.forEach((e, i) => {
      const originalIndex = equipData.indexOf(e);
      const statusClass = e.status === 'Disponível' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';
      const statusIcon = e.status === 'Disponível' ? 'fas fa-check-circle' : 'fas fa-clock';
      
      const row = document.createElement('tr');
      row.className = 'hover:bg-gray-50 transition-colors duration-150';
      row.innerHTML = `
        <td class="px-6 py-4">
          <div class="flex items-center">
            <div class="bg-primary-100 p-2 rounded-lg mr-3">
              <i class="fas fa-tools text-primary-600"></i>
            </div>
            <div>
              <div class="font-medium text-gray-900">${e.name}</div>
            </div>
          </div>
        </td>
        <td class="px-6 py-4">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            ${e.category}
          </span>
        </td>
        <td class="px-6 py-4 text-sm text-gray-900 font-mono">${e.serial}</td>
        <td class="px-6 py-4">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusClass}">
            <i class="${statusIcon} mr-1"></i>
            ${e.status}
          </span>
        </td>
        <td class="px-6 py-4 text-sm text-gray-700">${e.users.join(', ')}</td>
        <td class="px-6 py-4 text-center">
          ${e.status === 'Emprestado' ? 
            `<button class='bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition-colors duration-200 flex items-center mx-auto' onclick='checkIn(${originalIndex})'>
              <i class="fas fa-undo mr-1"></i>
              Devolver
            </button>` : 
            '<span class="text-gray-400 text-sm">-</span>'
          }
        </td>
      `;
      tbody.appendChild(row);
    });

    document.getElementById('equipCount').textContent = `${filteredEquip.length} equipamento(s)`;
  }

  function renderHistory() {
    histBody.innerHTML = '';
    const sortedHistory = [...historyData].reverse();
    
    sortedHistory.forEach(h => {
      const equipList = h.items.map(it => `${it.name} (${it.serial})`).join('<br>');
      const usersList = h.users.join('<br>');
      
      const row = document.createElement('tr');
      row.className = 'hover:bg-gray-50 transition-colors duration-150';
      row.innerHTML = `
        <td class="px-6 py-4 text-sm text-gray-900">${equipList}</td>
        <td class="px-6 py-4 text-sm text-gray-700">${usersList}</td>
        <td class="px-6 py-4 text-sm text-gray-900">${h.dateOut}</td>
        <td class="px-6 py-4 text-sm">
          ${h.dateIn ? 
            `<span class="text-green-600 font-medium">${h.dateIn}</span>` : 
            '<span class="text-orange-500 font-medium">Em aberto</span>'
          }
        </td>
        <td class="px-6 py-4 text-sm text-gray-700">${h.obs || '-'}</td>
      `;
      histBody.appendChild(row);
    });
  }

  function renderAll() {
    renderSelects();
    renderInventory();
    renderHistory();
    updateStats();
  }

  /* ======== EVENT HANDLERS ======== */
  document.getElementById('loanForm').addEventListener('submit', ev => {
    ev.preventDefault();
    const idxs = [...equipSel.selectedOptions].map(o => +o.value);
    if (!idxs.length) {
      showToast('Selecione pelo menos um equipamento', 'warning');
      return;
    }
    
    const users = [...studSel.selectedOptions].map(o => o.value);
    if (!users.length) {
      showToast('Selecione pelo menos um aluno responsável', 'warning');
      return;
    }
    
    const dateOut = document.getElementById('dateOut').value;
    if (!dateOut) {
      showToast('Informe a data de saída', 'warning');
      return;
    }

    // Update equipment status
    const items = [];
    idxs.forEach(idx => {
      const item = equipData[idx];
      item.status = 'Emprestado';
      item.users = users;
      items.push({name: item.name, serial: item.serial});
    });

    // Add to history
    historyData.push({
      items,
      users,
      dateOut,
      dateIn: '',
      obs: ''
    });

    saveHistory();
    ev.target.reset();
    updateSelectionCounters();
    renderAll();

    // Success feedback
    const button = ev.target.querySelector('button[type="submit"]');
    const originalContent = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check mr-3"></i><span>Empréstimo Confirmado!</span>';
    button.classList.add('from-green-500', 'to-emerald-600');
    
    showToast(`Empréstimo realizado com sucesso! ${items.length} equipamento(s) para ${users.length} aluno(s)`, 'success');
    
    setTimeout(() => {
      button.innerHTML = originalContent;
      button.classList.remove('from-green-500', 'to-emerald-600');
    }, 3000);
  });

  window.checkIn = idx => {
    const note = prompt('Observações sobre a devolução (opcional):', '');
    const item = equipData[idx];
    
    item.status = 'Disponível';
    item.users = [];

    // Update history
    for (let i = historyData.length - 1; i >= 0; i--) {
      const h = historyData[i];
      if (!h.dateIn && h.items.some(itm => itm.serial === item.serial)) {
        h.dateIn = today();
        if (note && note.trim()) h.obs = note.trim();
        break;
      }
    }

    saveHistory();
    renderAll();
    showToast(`Equipamento ${item.name} (${item.serial}) devolvido com sucesso!`, 'success');
  };

  document.getElementById('clearBtn').onclick = () => {
    if (confirm('Tem certeza que deseja apagar todo o histórico de empréstimos?')) {
      historyData = [];
      saveHistory();
      renderHistory();
      showToast('Histórico de empréstimos limpo', 'info');
    }
  };

  categoryFilter.addEventListener('change', renderInventory);

  // Selection counter listeners
  equipSel.addEventListener('change', updateSelectionCounters);
  studSel.addEventListener('change', updateSelectionCounters);

  /* ======== INITIALIZATION ======== */
  function init() {
    // Set today's date as default
    document.getElementById('dateOut').valueAsDate = new Date();
    updateCurrentDate();
    
    // Load data with enhanced feedback
    setTimeout(() => {
      loadDataFiles();
      renderAll();
      updateSelectionCounters();
      
      // Smooth loading transition
      const loadingOverlay = document.getElementById('loadingOverlay');
      loadingOverlay.style.opacity = '0';
      
      setTimeout(() => {
        loadingOverlay.style.display = 'none';
        
        // Welcome message
        showToast('Sistema inicializado com sucesso! Todos os equipamentos carregados.', 'success', 4000);
        
        // Animate elements into view
        const elements = document.querySelectorAll('.animate-scale-in, .animate-slide-in, .animate-fade-in');
        elements.forEach((el, i) => {
          setTimeout(() => {
            el.style.opacity = '1';
          }, i * 100);
        });
      }, 600);
    }, 1800);
    
    // Auto-update date every minute
    setInterval(updateCurrentDate, 60000);
  }

  // Start the application
  init();
  </script>
</body>
</html>
